alter table VILLAGE_SETTINGS add column IS_RANDOM_ORGANIZE BOOLEAN NOT NULL COMMENT '闇鍋構成か' after IS_AVAILABLE_ACTION;

update VILLAGE_SETTINGS set IS_RANDOM_ORGANIZE = false;

CREATE TABLE CAMP_ALLOCATION
(
	VILLAGE_ID INT UNSIGNED NOT NULL COMMENT '村ID',
	CAMP_CODE VARCHAR(20) NOT NULL COMMENT '陣営コード',
	MIN_NUM INT UNSIGNED NOT NULL COMMENT '最小人数',
	MAX_NUM INT UNSIGNED COMMENT '最大人数',
	ALLOCATION INT UNSIGNED NOT NULL COMMENT '配分',
	REGISTER_DATETIME DATETIME NOT NULL COMMENT '登録日時',
	REGISTER_TRACE VARCHAR(64) NOT NULL COMMENT '登録トレース',
	UPDATE_DATETIME DATETIME NOT NULL COMMENT '更新日時',
	UPDATE_TRACE VARCHAR(64) NOT NULL COMMENT '更新トレース',
	PRIMARY KEY (VILLAGE_ID, CAMP_CODE)
) COMMENT = '陣営配分';

CREATE TABLE SKILL_ALLOCATION
(
	VILLAGE_ID INT UNSIGNED NOT NULL COMMENT '村ID',
	SKILL_CODE VARCHAR(20) NOT NULL COMMENT '役職コード',
	MIN_NUM INT UNSIGNED NOT NULL COMMENT '最小人数',
	MAX_NUM INT UNSIGNED COMMENT '最大人数',
	ALLOCATION INT UNSIGNED NOT NULL COMMENT '配分',
	REGISTER_DATETIME DATETIME NOT NULL COMMENT '登録日時',
	REGISTER_TRACE VARCHAR(64) NOT NULL COMMENT '登録トレース',
	UPDATE_DATETIME DATETIME NOT NULL COMMENT '更新日時',
	UPDATE_TRACE VARCHAR(64) NOT NULL COMMENT '更新トレース',
	PRIMARY KEY (VILLAGE_ID, SKILL_CODE)
) COMMENT = '役職配分';

ALTER TABLE CAMP_ALLOCATION
	ADD CONSTRAINT FK_CAMP_ALLOCATION_CAMP FOREIGN KEY (CAMP_CODE)
	REFERENCES CAMP (CAMP_CODE)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;

ALTER TABLE SKILL_ALLOCATION
	ADD CONSTRAINT FK_SKILL_ALLOCATION_SKILL FOREIGN KEY (SKILL_CODE)
	REFERENCES SKILL (SKILL_CODE)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;

ALTER TABLE CAMP_ALLOCATION
	ADD CONSTRAINT FK_CAMP_ALLOCATION_VILLAGE FOREIGN KEY (VILLAGE_ID)
	REFERENCES VILLAGE (VILLAGE_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;

ALTER TABLE SKILL_ALLOCATION
	ADD CONSTRAINT FK_SKILL_ALLOCATION_VILLAGE FOREIGN KEY (VILLAGE_ID)
	REFERENCES VILLAGE (VILLAGE_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;
