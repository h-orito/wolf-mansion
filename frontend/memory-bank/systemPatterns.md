# システムパターン (System Patterns)

## システムアーキテクチャ

WOLF MANSIONのフロントエンドは、Next.jsを使用したクライアントサーバーアーキテクチャを採用しています。全体的なアーキテクチャは以下の通りです：

```
+-------------------+      +-------------------+
|                   |      |                   |
|   Next.js         |      |   バックエンド     |
|   フロントエンド    +----->+   API サーバー    |
|                   |      |                   |
+-------------------+      +-------------------+
```

### フロントエンドアーキテクチャ

フロントエンドは、Next.jsのApp Routerを使用したページベースのアーキテクチャを採用しています。主要なコンポーネントは以下の通りです：

1. **ページコンポーネント**：`src/app/`ディレクトリに配置され、各ルートに対応するページを定義します。
2. **UIコンポーネント**：`src/components/ui/`ディレクトリに配置され、再利用可能なUIコンポーネントを提供します。
3. **APIクライアント**：`src/components/api/`ディレクトリに配置され、バックエンドAPIとの通信を担当します。
4. **型定義**：`src/lib/openapi-typescript/`ディレクトリに配置され、OpenAPIから生成された型定義を提供します。

## 主要な技術的決定

1. **Next.js**：サーバーサイドレンダリング（SSR）とクライアントサイドレンダリング（CSR）の両方をサポートし、SEOとパフォーマンスを最適化するために採用しました。

2. **TypeScript**：型安全性を確保し、開発時のエラー検出を強化するために採用しました。

3. **Tailwind CSS**：迅速なUIの開発と一貫したデザインシステムの実装のために採用しました。

4. **OpenAPI**：バックエンドAPIの型定義を自動生成し、フロントエンドとバックエンドの型の一貫性を確保するために採用しました。

## デザインパターン

1. **コンポーネントベースアーキテクチャ**：UIを再利用可能なコンポーネントに分割し、保守性と再利用性を高めています。

2. **サービスレイヤーパターン**：APIとの通信を抽象化し、ビジネスロジックとデータアクセスを分離しています。

3. **フックパターン**：React Hooksを使用して、状態管理とライフサイクルロジックをカプセル化しています。

4. **型駆動開発**：OpenAPIから生成された型定義を使用して、APIとの通信の型安全性を確保しています。

## コンポーネント間の関係

```
+----------------+     +----------------+     +----------------+
|                |     |                |     |                |
|  ページコンポーネント |---->| UIコンポーネント  |     |  型定義        |
|  (src/app/)    |     |  (src/components/ui)|     |  (src/lib/)   |
|                |     |                |     |                |
+----------------+     +----------------+     +----------------+
        |                                            |
        v                                            |
+----------------+                                   |
|                |                                   |
|  APIクライアント  |<----------------------------------+
|  (src/components/api)|
|                |
+----------------+
```

1. **ページコンポーネント**は、UIコンポーネントを組み合わせてページを構成し、APIクライアントを使用してデータを取得します。
2. **UIコンポーネント**は、再利用可能なUIの構成要素を提供します。
   - **Button**: primary, secondary, dangerなどのバリアントを持つボタンコンポーネント
   - **Modal**: ダークテーマ対応のモーダルコンポーネント
   - **Alert**: primary, secondary, success, danger, warning, infoのバリアントを持つアラートコンポーネント。背景色はgray-800に固定され、テキストと枠線の色のみがバリアントによって変化します。エラーメッセージや成功メッセージの表示に使用されます。
   - **Breadcrumb**: ホームへの動線を提供するパンくずリストコンポーネント。複数階層に対応し、現在のページは非リンク表示になります。FontAwesomeアイコンを使用してホームアイコンと区切り記号を表示します。
   - **Panel**: ヘッダーをクリックすると内容が開閉できるパネルコンポーネント。開閉はアニメーションが付く。
3. **グローバルスタイル**は、`globals.scss`に定義され、アプリケーション全体で再利用可能なスタイルを提供します。
   - **list-content**: リスト用のスタイル（リストマーカー、間隔、フォントサイズなど）
   - **list-content-nested**: 入れ子リスト用のスタイル
   - **content-section**: セクション用のスタイル（背景色、余白、マージンなど）
   - **section-title**: セクションタイトル用のスタイル（フォントサイズ、太さ、アイコンとの間隔など）
   - **link-style**: リンク用のスタイル（色、ホバー効果など）
4. **APIクライアント**は、型定義を使用してバックエンドAPIとの型安全な通信を実現します。
5. **型定義**は、OpenAPIから生成され、アプリケーション全体で一貫した型を提供します。

## データフロー

1. ユーザーがページにアクセスすると、Next.jsのサーバーコンポーネントがサーバーサイドでデータを取得します。
2. 取得したデータは、ページコンポーネントからUIコンポーネントに渡されます。
3. ユーザーのインタラクションにより、クライアントコンポーネントがAPIクライアントを使用してデータを更新します。
4. 更新されたデータは、状態管理を通じてUIに反映されます。

このアーキテクチャにより、型安全性、パフォーマンス、保守性を確保しながら、リッチなユーザー体験を提供することが可能になっています。
