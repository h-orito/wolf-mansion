<html lang="ja" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
</head>
<body>
<div class="col-sm-12 col-xs-12" th:if="${content.form.say.dispSayForm}" layout:fragment="say-form">
    <div class="panel-group" id="sayform-panel">
        <div class="panel panel-default">
            <div class="panel-heading">
                <a class="h5" data-toggle="collapse" data-parent="#sayform-panel" href="#sayform-content"
                   data-sayform-tab-open>発言</a> <a
                    href="javascript:void(0);" class="pull-right" data-bottom-fix>固定</a>
            </div>
            <div id="sayform-content" class="panel-collapse collapse in">
                <div class="panel-body">
                    <div class="alert alert-dead small" th:if="${content.myself.dead}">
                        <ul>
                            <li>あなたは死亡しました。現世の思い出を語り合いましょう。</li>
                            <li th:if="${!content.settings.visibleGraveSpectateMessage}">墓下では推理発言やCOを行っても問題ありません。</li>
                        </ul>
                    </div>
                    <div class="alert alert-warning-say small"
                         th:if="${!content.myself.dead || (content.myself.dead && content.settings.visibleGraveSpectateMessage)}">
                        <ul>
                            <li th:if="${content.settings.visibleGraveSpectateMessage}">この村は、墓下や見学発言を生存者が参照できます。</li>
                            <li th:if="${content.settings.visibleGraveSpectateMessage}">
                                進行中は、推理、まとめ、および推理に繋がる内容は生存者全員が見られる発言種別で発言しないでください。
                            </li>
                            <li th:if="${!content.settings.visibleGraveSpectateMessage}">
                                進行中は、推理、まとめ、および推理に繋がる内容は通常発言で発言しないでください。
                            </li>
                            <li>COおよび能力行使結果の発表は生存中の導師と探偵のみ行うことができます。騙りCOも禁止です。</li>
                        </ul>
                    </div>
                    <a href="javascript:void(0);" data-toggle="collapse" data-target="#sayform" class="h5 hidden"
                       aria-expanded="true" data-say-tab>発言する</a> <span
                        th:if="${sayErrorMessage != null}" class="text-danger" th:test="${sayErrorMessage}">error</span>
                    <form method="post" id="sayform" action=""
                          th:action="@{/village/{villageId}/confirm(villageId=${content.villageId})}"
                          th:object="${sayForm}"
                          class="form-horizontal collapse in" aria-expanded="true" style="margin-top: 10px;">
                        <span th:if="${#fields.hasErrors('message')}" th:errors="*{message}"
                              class="help-block text-danger">error!</span>
                        <p th:text="${content.myself.charaName}"></p>
                        <div class="form-group">
                            <div class="col-sm-12 col-xs-12 btn-group btn-saytypes" data-toggle="buttons" data-say-type>
                                <label th:if="${content.form.say.availableWerewolfSay}"
                                       th:class="'btn btn-sm btn-success ' + *{messageType == 'WEREWOLF_SAY' ? 'active' : ''}">
                                    <input type="radio" class="" th:field="*{messageType}" value="WEREWOLF_SAY"
                                           autocomplete="off"/>囁き
                                </label>
                                <label th:if="${content.form.say.availableMasonSay}"
                                       th:class="'btn btn-sm btn-success ' + *{messageType == 'MASON_SAY' ? 'active' : ''}">
                                    <input type="radio" class="" th:field="*{messageType}" value="MASON_SAY"
                                           autocomplete="off"/>共鳴
                                </label>
                                <label th:if="${content.form.say.availableLoversSay}"
                                       th:class="'btn btn-sm btn-success ' + *{messageType == 'LOVERS_SAY' ? 'active' : ''}">
                                    <input type="radio" class="" th:field="*{messageType}" value="LOVERS_SAY"
                                           autocomplete="off"/>恋人
                                </label>
                                <label th:if="${content.form.say.availableNormalSay}"
                                       th:class="'btn btn-sm btn-success ' + *{messageType == 'NORMAL_SAY' ? 'active' : ''}">
                                    <input type="radio" class="" th:field="*{messageType}" value="NORMAL_SAY"
                                           autocomplete="off"/>通常
                                </label>
                                <label th:if="${content.form.say.availableGraveSay}"
                                       th:class="'btn btn-sm btn-success ' + *{messageType == 'GRAVE_SAY' ? 'active' : ''}">
                                    <input type="radio" class="" th:field="*{messageType}" value="GRAVE_SAY"
                                           autocomplete="off"/>呻き
                                </label>
                                <label th:if="${content.form.say.availableSpectateSay}"
                                       th:class="'btn btn-sm btn-success ' + *{messageType == 'SPECTATE_SAY' ? 'active' : ''}">
                                    <input type="radio" class="" th:field="*{messageType}" value="SPECTATE_SAY"
                                           autocomplete="off"/>見学
                                </label>
                                <label th:if="${content.form.say.availableMonologueSay}"
                                       th:class="'btn btn-sm btn-success ' + *{messageType == 'MONOLOGUE_SAY' ? 'active' : ''}">
                                    <input type="radio" class="" th:field="*{messageType}" value="MONOLOGUE_SAY"
                                           autocomplete="off"/>独り言
                                </label>
                                <label th:if="${content.form.say.availableSecretSay}"
                                       class="btn btn-sm btn-success">
                                    <input type="radio" class="" th:field="*{messageType}" value="SECRET_SAY"
                                           autocomplete="off" data-secret-say/>秘話
                                </label>
                            </div>
                            <div class="col-sm-12 col-xs-12 hidden" style="margin-top: 10px; margin-bottom: 10px;"
                                 data-secret-say-target>
                                <label class="control-label">秘話相手</label>
                                <select class="form-control" th:field="*{secretSayTargetCharaId}"
                                        th:if="${content.form.say.availableSecretSay}">
                                    <option th:each="chara : ${content.form.say.secretSayTargetList}"
                                            th:value="${chara.value}" th:text="${chara.name}"></option>
                                </select>
                                <a href="javascript:void(0);" data-toggle="modal"
                                   data-target="#modal-select-secretsay-target-chara"
                                   class="btn btn-sm btn-success">画像から選択</a>
                            </div>
                            <div class="col-sm-12 col-xs-12" style="display: flex;">
                                <div>
                                    <img id="say-face-img" th:src="${content.myself.charaImageUrl}"
                                         th:width="${content.myself.charaImageWidth}"
                                         th:height="${content.myself.charaImageHeight}">
                                    <div style="position: absolute; bottom: 0;">
                                        表情<br> <select class="form-control small" th:field="*{faceType}"
                                                       th:style="'padding-left: 0px; padding-right: 0px; font-size: 86%; max-width: ' + ${content.myself.charaImageWidth} + 'px;'">
                                        <option th:each="face : ${content.form.say.faceTypeList}"
                                                th:value="${face.value}" th:text="${face.name}"></option>
                                    </select>
                                    </div>
                                </div>
                                <div style="flex: 1; margin-left: 5px; min-height: 150px;">
                                    <textarea class="form-control small" th:field="*{message}"
                                              style="min-height: 150px;" data-say-textarea></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-12 col-xs-12">
									<span class="" style="margin-left: 55px;" data-message-count
                                          th:data-message-restrict-normal-max-length="${content.form.say.restrict.normalLength != null ? content.form.say.restrict.normalLength : ''}"
                                          th:data-message-restrict-normal-max-count="${content.form.say.restrict.normalCount != null ? content.form.say.restrict.normalCount : ''}"
                                          th:data-message-restrict-normal-left-count="${content.form.say.restrict.normalLeftCount != null ? content.form.say.restrict.normalLeftCount : ''}"
                                          th:data-message-restrict-whisper-max-length="${content.form.say.restrict.whisperLength != null ? content.form.say.restrict.whisperLength : ''}"
                                          th:data-message-restrict-whisper-max-count="${content.form.say.restrict.whisperCount != null ? content.form.say.restrict.whisperCount : ''}"
                                          th:data-message-restrict-whisper-left-count="${content.form.say.restrict.whisperLeftCount != null ? content.form.say.restrict.whisperLeftCount : ''}"
                                          th:data-message-restrict-mason-max-length="${content.form.say.restrict.masonLength != null ? content.form.say.restrict.masonLength : ''}"
                                          th:data-message-restrict-mason-max-count="${content.form.say.restrict.masonCount != null ? content.form.say.restrict.masonCount : ''}"
                                          th:data-message-restrict-mason-left-count="${content.form.say.restrict.masonLeftCount != null ? content.form.say.restrict.masonLeftCount : ''}"
                                          th:data-message-restrict-lovers-max-length="${content.form.say.restrict.loversLength != null ? content.form.say.restrict.loversLength : ''}"
                                          th:data-message-restrict-lovers-max-count="${content.form.say.restrict.loversCount != null ? content.form.say.restrict.loversCount : ''}"
                                          th:data-message-restrict-lovers-left-count="${content.form.say.restrict.loversLeftCount != null ? content.form.say.restrict.loversLeftCount : ''}">残り20回,
										文字数: 0/400, 行数: 1/20</span><br> <input type="checkbox" class="form-check-input"
                                                                               th:field="*{convertDisable}"
                                                                               value="true"
                                                                               style="margin-left: 55px;"> <label
                                    class="form-check-label" for="convertDisable">装飾・変換無効</label> <input type="submit"
                                                                                                         class="btn btn-sm btn-success pull-right"
                                                                                                         value="確認画面へ"
                                                                                                         data-message-submit-btn/>
                            </div>
                        </div>
                    </form>
                    <a th:href="@{/rule#other}" target="_blank" class="pull-right">文字装飾・ランダム機能</a>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" th:if="${content.form.say.availableSecretSay}"
         id="modal-select-secretsay-target-chara" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body row">
                    <div class="col-sm-12 col-xs-12">
                        <h4>キャラクター選択</h4>
                        <div class="col-sm-4 col-xs-6"
                             style="border: 1px solid #464545; padding: 5px;"
                             th:if="${content.form.say.secretSayTargetList}"
                             th:each="chara : ${content.form.say.secretSayTargetList}">
								                        <span style="display: block; text-align: center;">
                                                            <img src="" th:src="${chara.url}"
                                                                 th:width="${chara.width}"
                                                                 th:height="${chara.height}"/>
                                                        </span>
                            <span style="display: block; text-align: center;"
                                  th:text="${chara.name}"></span>
                            <a href="javascript:void(0);" class="btn btn-xs btn-success"
                               style="display: block; text-align: center;"
                               th:data-select-secretsay-chara="${chara.value}">選択</a>
                        </div>
                    </div>
                    <div class="col-sm-12 col-xs-12 small">
                        <a href="javascript:void(0);"
                           class="btn btn-primary pull-right small"
                           data-dismiss="modal"
                           style="margin-top: 10px;">閉じる</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>